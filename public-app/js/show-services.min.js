!function(){"use strict";function n(n,t,e,o){function u(n){n=n||y,A[n]&&(A[n].$$state.status||t.cancel(A[n])?A[n]=null:e.error("Could not cancel showId: "+n))}function l(n,i,e){n=n||y,i=i||S,e=e||0,u(n),A[n]=t(c,r,1,!0,n,i,e)}function a(n,r){var i={},t=!1;for(var o in n)if(n[o].$dirty){if(n[o].$invalid)return e.error("Should not call copyChangedFields on invalid form"),null;t=!0,i[o]=r[o]}return t?i:void e.error("All model objects are pristine")}function c(n,r,i){var t=null;A[n]=null,C[n]?(t=a(C[n],r),t||e.error("An invalid object was saved")):n==y&&g.$dirty&&g.$valid&&(t=a(b,r),t&&(g.$setPristine(),g.$setUntouched())),t&&(n===D?s(t,i):f(n,t,i))}function s(r,i){n.createShow(r).success(function(n){r._id=n,y=n}).error(d(D,r,i))}function f(r,i,t){n.updateShow(r,i).success(function(){C[r]&&(C[r]=null)}).error(d(r,i,t))}function d(n,r,t){return function(o){if(e.info(o),y==n)for(var a in r)b[a].$setDirty(!0),b[a].$setTouched(!0),b[a].$validate();o.validationFailed===!0?u(n):i-1>t?l(n,r,t+1):e.error("Attempted to save "+i+" times unsuccessfully",o)}}function v(){if(!y||!b)return e.error("Tried saving current before initialisation"),!1;if(y==D)return!1;if(A[y])if(g.$pristine)u(y);else{if(g.$invalid)return!1;var n={};for(var r in b)n[r]={$dirty:b[r].$dirty,$valid:b[r].$valid};C[y]=n}return!0}function $(){for(var n in A)u(n);for(var n in C)C[n]=null;y=null,g=null,S=null,b=null}function h(){for(;j.length>0;)j.pop()();for(var n in g)"$"!=n[0]&&(b[n]=g[n],j.push(o.$watch(function(n){return function(){return S[n]}}(n),function(n,r){l()})))}function w(n,r){return g&&g.$invalid?void e.error("attempted initialising while current form invalid"):(g=n,S=r,b={},void h())}function p(n,r){y=r._id,w(n,r)}function m(n,r){return y==D?void e.error("attempted to initialise a new show before previous new show was saved"):(y=D,void w(n,r))}var y,g,S,b,A={},C={},j=[],D="newId";return{initShow:p,initNew:m,storeCurrent:v,clearAll:$}}angular.module("shows").service("showSaver",["showData","$interval","$log","$rootScope",n]);var r=1e3,i=5}();
//# sourceMappingURL=../maps/show-services.min.js.map